record(mbbi, "$(crat):MCHTYPE") {
  field(DESC, "MCH vendor")
  field(DTYP, "MCHsensor")
  field(SCAN, "I/O Intr")
  field(INP,  "#C0 S0 @$(node)+MCH")
  field(ZRST, "Unknown")
  field(ZRVL, "0")
  field(ZRSV, "MAJOR")
  field(ONST, "Vadatech")
  field(ONVL, "1")
  field(ONSV, "NO_ALARM")
  field(TWST, "NAT")
  field(TWVL, "2")
  field(TWSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "$(crat):STAT") {
  field(DESC, "MCH online status")
  field(DTYP, "MCHsensor")
  field(SCAN, "I/O Intr")
  field(INP, "#C0 S0 @$(node)+STAT")
  field(ZNAM, "Offline")
  field(ZSV,  "MAJOR")
  field(ONAM, "Online")
  field(OSV,  "NO_ALARM")
  field(PINI, "YES")
}

record(mbbi, "$(crat):INIT") {
  field(DESC, "MCH comm initialized")
  field(DTYP, "MCHsensor")
  field(SCAN, "I/O Intr")
  field(INP,  "#C0 S0 @$(node)+INIT")
  field(ZRST, "Not initialized")
  field(ZRVL, "0")
  field(ZRSV, "MAJOR")
  field(ONST, "Initializing...")
  field(ONVL, "1")
  field(ONSV, "MINOR")
  field(TWST, "Initialized")
  field(TWVL, "2")
  field(TWSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bo, "$(crat):INITBYP") {
  field(DESC, "Override init for testing")
  field(DTYP, "MCHsensor")
  field(OMSL, "supervisory")
  field(OUT, "#C0 S0 @$(node)+INIT")
  field(ZNAM, "Not initialized")
  field(ZSV,  "MAJOR")
  field(ONAM, "Initialized")
  field(OSV,  "NO_ALARM")
  field(PINI, "NO")
}

# Enable or disable session with MCH
record(bo, "$(crat):SESSENBL") {
  field(DESC, "MCH session enable")
  field(DTYP, "MCHsensor")
  field(OMSL, "supervisory")
  field(OUT,  "#C0 S0 @$(node)+SESS")
  field(ZNAM, "Disabled")
  field(ZSV,  "MAJOR")
  field(ONAM, "Enabled")
  field(OSV,  "NO_ALARM")
  field(RVAL,  "1")
  field(PINI, "YES")
}

# Sends Chassis Control IPMI command
# Vadatech MCH results are unreliable
# NAT MCH does not implement this command
# So, this record is not very useful
record(mbbo, "$(crat):POWERCTL") {
  field(DTYP, "MCHsensor")
  field(OMSL, "supervisory")
  field(OUT, "#C0 S0 @$(node)+CHAS")
  field(ZRVL, "0")
  field(ZRST, "Power off")
  field(ONVL, "1")
  field(ONST, "Power on")
  field(THVL, "3")
  field(THST, "Hard reset")
  field(VAL,  "1")
}

# Peform IPMI 'Cold Reset'
record(bo, "$(crat):RESET") {
  field(DTYP, "MCHsensor")
  field(OMSL, "supervisory")
  field(OUT, "#C0 S0 @$(node)+RESET")
}

# Not yet supported by Vadatech MCH
#record(ai, "$(crat):POWERSTATE") {
#  field(DTYP, "MCHsensor")
#  field(INP, "#C0 S0 @$(node)+CHAS")
#}

