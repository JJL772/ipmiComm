# FRU 'presence' record to indicate whether FRU
# is active; used by edm visibility rules
record(bi, "$(dev):$(code)$(inst)P") {
  field(DESC, "Module presence")
  field(SCAN, "I/O Intr")
  field(DTYP, "MCHsensor")
  field(INP, "#B$(fruid) C0 N0 @$(link)+fpres")
  field(ZNAM, "Not present")
  field(ONAM, "Present")
  field(PINI, "YES")
}

# Vadatech 'hotswap' sensor, provides FRU M-state
record(mbbi, "$(dev):$(code)$(inst)_MSTATE") {
  field(SCAN, "10 second")
  field(DTYP, "MCHsensor")
  field(INP,  "#B$(fruid) C240 N1 @$(link)+hs")
  field(ONVL, "0x01")
  field(ONST, "Not Installed")
  field(TWVL, "0x02")
  field(TWST, "Inactive")
  field(THVL, "0x04")
  field(THST, "Activation Request")
  field(FRVL, "0x08")
  field(FRST, "Activation In Progress")
  field(FVVL, "0x10")
  field(FVST, "Active")
  field(SXVL, "0x20")
  field(SXST, "Deactivation Request")
  field(SVVL, "0x40")
  field(SVST, "Deactivation In Progress")
  field(EIVL, "0x80")
  field(EIST, "Communication Lost")
}

record(mbbi, "$(dev):$(code)$(inst)_TYPE") {
  field(DESC, "Module type")
  field(VAL,  "0")
  field(ZRVL, "0")
  field(ZRST, "Unknown")
  field(ONVL, "0xC2")
  field(ONST, "MCH")
  field(TWVL, "0xC1")
  field(TWST, "AMC")
  field(THVL, "0x1E")
  field(THST, "CU")
  field(FRVL, "0x0A")
  field(FRST, "PM")
  field(FVVL, "0xC0")
  field(FVST, "RTM")
}

record(ai, "$(dev):$(code)$(inst)_FRUID") {
  field(DESC, "Module type")
  field(VAL,  "$(fruid)")
  field(PINI, "YES")
}

record(stringin, "$(dev):$(code)$(inst)_BMANUF") {
  field(DESC, "Board manufacturer")
  field(SCAN, "I/O Intr")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+bmf")
  field(PINI, "YES")
  field(FLNK, "$(dev):$(code)$(inst)_BPRODNAME")
}

record(stringin, "$(dev):$(code)$(inst)_BPRODNAME") {
  field(DESC, "Board product name")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+bp")
  field(FLNK, "$(dev):$(code)$(inst)_BSN")
}

record(stringin, "$(dev):$(code)$(inst)_BSN") {
  field(DESC, "Board serial number")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+bsn")
  field(FLNK, "$(dev):$(code)$(inst)_BPARTNUMBER")
}

record(stringin, "$(dev):$(code)$(inst)_BPARTNUMBER") {
  field(DESC, "Board part number")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+bpn")
  field(FLNK, "$(dev):$(code)$(inst)_PMANUF")
}

record(stringin, "$(dev):$(code)$(inst)_PMANUF") {
  field(DESC, "Product manufacturer")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+pmf")
  field(FLNK, "$(dev):$(code)$(inst)_PPRODNAME")
}

record(stringin, "$(dev):$(code)$(inst)_PPRODNAME") {
  field(DESC, "Product product name")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+pp")
  field(FLNK, "$(dev):$(code)$(inst)_PSN")
}

record(stringin, "$(dev):$(code)$(inst)_PSN") {
  field(DESC, "Product serial number")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+psn")
  field(FLNK, "$(dev):$(code)$(inst)_PPARTNUMBER")
}

record(stringin, "$(dev):$(code)$(inst)_PPARTNUMBER") {
  field(DESC, "Product part number")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+ppn")
}

record(mbbo, "$(dev):$(code)$(inst)_POWERCTL") {
  field(DESC, "Payload power control")
  field(DTYP, "MCHsensor")
  field(OMSL, "supervisory")
  field(OUT, "#B$(fruid) C0 N0  @$(link)+fru")
  field(ZRST, "Power off")
  field(ONST, "Power on")
#  reset not supported yet
#  field(TWST, "Hard reset")
}

record(ai, "$(dev):$(code)$(inst)_PWR") {
  field(DESC, "Steady state power draw")
  field(SCAN, "10 second")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+pwr")
  field(EGU, "W")
  field(FLNK, "$(dev):$(code)$(inst)_PWRDES")
}

record(ai, "$(dev):$(code)$(inst)_PWRDES") {
  field(DESC, "Desired steady state power draw")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C1 N0  @$(link)+pwr")
  field(EGU, "W")
  field(FLNK, "$(dev):$(code)$(inst)_EPWR")
}

record(ai, "$(dev):$(code)$(inst)_EPWR") {
  field(DESC, "Early power draw")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C2 N0  @$(link)+pwr")
  field(EGU, "W")
  field(FLNK, "$(dev):$(code)$(inst)_EPWRDES")
}

record(ai, "$(dev):$(code)$(inst)_EPWRDES") {
  field(DESC, "Desired early power draw")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C3 N0  @$(link)+pwr")
  field(EGU, "W")
  field(FLNK, "$(dev):$(code)$(inst)_PWRDLY")
}

record(ai, "$(dev):$(code)$(inst)_PWRDLY") {
  field(DESC, "FRU delay to stable power")
  field(DTYP, "FRUinfo")
  field(INP, "#B$(fruid) C0 N0  @$(link)+pwr")
  field(EGU, "s")
  field(FLNK, "$(dev):$(code)$(inst)_PWRDYN")
}

record(mbbi, "$(dev):$(code)$(inst)_PWRDYN") {
  field(DESC, "FRU supports dynamic pwr reconfig")
  field(DTYP, "MCHsensor")
  field(INP,  "#B$(fruid) C0 N0  @$(link)+pwr")
  field(ZRST, "No")
  field(ZRVL, "0")
  field(ONST, "Yes")
  field(ONVL, "1")
}
